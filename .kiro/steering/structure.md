# 项目结构和组织

## 目录结构

```
CatTag/
├── cmd/                    # 应用程序入口点
│   └── app/               # 主应用程序
│       ├── main.go        # 程序入口
│       └── main_test.go   # 入口测试
├── internal/              # 内部包（不对外暴露）
│   ├── adapter/           # 蓝牙适配器实现
│   ├── device/            # 设备管理
│   ├── protocol/          # 协议处理
│   ├── security/          # 安全管理
│   └── config/            # 配置管理
├── pkg/                   # 公共库（可被外部引用）
│   ├── bluetooth/         # 蓝牙核心接口
│   ├── client/            # 客户端实现
│   ├── server/            # 服务端实现
│   ├── message/           # 消息处理
│   ├── pool/              # 连接池管理
│   └── health/            # 健康检查
├── examples/              # 示例应用
├── docs/                  # 文档
└── test/                  # 集成测试
```

## 架构模式

### 分层架构

- **接口层 (pkg/)**: 对外暴露的公共接口和类型定义
- **实现层 (internal/)**: 具体实现，不对外暴露
- **应用层 (cmd/)**: 应用程序入口和配置

### 组件设计原则

- **接口优先**: 所有核心功能都定义接口，便于测试和扩展
- **依赖注入**: 使用构建器模式管理组件依赖
- **泛型支持**: 充分利用 Go 1.25 泛型特性提供类型安全
- **并发安全**: 所有公共接口都是并发安全的

## 命名约定

### 包命名

- 使用小写字母，避免下划线
- 包名应该简洁且具有描述性
- 内部包使用 `internal/` 前缀

### 接口命名

- 接口名使用 `er` 后缀（如 `BluetoothAdapter`）
- 单方法接口优先使用动词+er（如 `Scanner`, `Connector`）

### 类型命名

- 结构体使用大驼峰命名
- 配置类型使用 `Config` 后缀
- 错误类型使用 `Error` 后缀

### 文件组织

- 每个包的主要类型定义在同名文件中
- 测试文件使用 `_test.go` 后缀
- 示例代码使用 `example_` 前缀

## 依赖管理

### 外部依赖原则

- 最小化外部依赖
- 优先使用标准库
- 必要时使用成熟稳定的第三方库

### 内部依赖规则

- `pkg/` 包不能依赖 `internal/` 包
- `internal/` 包可以依赖 `pkg/` 包
- 避免循环依赖

## 错误处理

### 错误类型

- 使用自定义错误类型提供详细信息
- 错误包装使用 `fmt.Errorf` 和 `%w` 动词
- 关键路径的错误必须有详细的上下文信息

### 日志记录

- 使用结构化日志记录
- 区分不同级别的日志（Debug, Info, Warn, Error）
- 敏感信息不记录到日志中
