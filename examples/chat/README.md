# 蓝牙聊天应用示例

这是一个使用 CatTag 蓝牙通信库开发的聊天应用示例，演示了如何在蓝牙设备间进行实时文本消息交换。

## 功能特性

- **双模式支持**: 支持服务端和客户端模式
- **实时消息**: 支持实时文本消息传输
- **多用户聊天**: 支持多个设备同时连接聊天
- **消息历史**: 保存和查看聊天历史记录
- **用户管理**: 显示在线用户列表
- **连接监控**: 实时显示连接状态和统计信息
- **命令系统**: 内置命令系统，支持各种聊天功能

## 快速开始

### 1. 编译应用

```bash
cd examples/chat
go build -o chat main.go
```

### 2. 启动服务端

```bash
./chat -mode=server -username="服务端用户" -service="12345678-1234-1234-1234-123456789abc"
```

### 3. 启动客户端

在另一个终端或设备上：

```bash
./chat -mode=client -username="客户端用户" -service="12345678-1234-1234-1234-123456789abc"
```

## 命令行参数

- `-mode`: 运行模式，可选 `server` 或 `client`（默认: server）
- `-username`: 用户名（默认: 用户）
- `-service`: 蓝牙服务 UUID（默认: 12345678-1234-1234-1234-123456789abc）
- `-log-level`: 日志级别，可选 `debug`, `info`, `warn`, `error`（默认: info）

## 聊天命令

在聊天界面中，您可以使用以下命令：

- `/help` - 显示帮助信息
- `/quit` 或 `/exit` - 退出聊天应用
- `/users` - 显示在线用户列表
- `/history` - 显示消息历史记录
- `/clear` - 清屏
- `/status` - 显示连接状态和统计信息

直接输入文本即可发送消息。

## 使用示例

### 服务端启动示例

```bash
$ ./chat -mode=server -username="Alice"
=== CatTag 蓝牙聊天应用 ===
模式: server
用户名: Alice
服务UUID: 12345678-1234-1234-1234-123456789abc
输入 '/help' 查看帮助信息
输入 '/quit' 退出应用
================================
[系统] 聊天服务端已启动，等待客户端连接...
[15:30:25] [系统] 聊天室已创建，等待用户加入...
```

### 客户端连接示例

```bash
$ ./chat -mode=client -username="Bob"
=== CatTag 蓝牙聊天应用 ===
模式: client
用户名: Bob
服务UUID: 12345678-1234-1234-1234-123456789abc
输入 '/help' 查看帮助信息
输入 '/quit' 退出应用
================================
[系统] 聊天客户端已启动，正在搜索服务端...
[系统] 发现 1 个设备:
  1. Alice的设备 (device_001)
[系统] 正在连接到 Alice的设备...
[系统] 已连接到 Alice的设备
[15:30:30] [系统] 已加入聊天室 (Alice的设备)
```

### 聊天对话示例

```
[15:30:35] Bob: 大家好！
[15:30:40] Alice: 欢迎加入聊天室！
[15:30:45] Bob: 这个蓝牙聊天很有趣
[15:30:50] Alice: 是的，基于 CatTag 库开发的
```

## 技术实现

### 消息结构

```go
type ChatMessage struct {
    ID        string    `json:"id"`         // 消息ID
    Sender    string    `json:"sender"`     // 发送者
    Content   string    `json:"content"`    // 消息内容
    Timestamp time.Time `json:"timestamp"`  // 时间戳
    Type      string    `json:"type"`       // 消息类型
}
```

### 核心组件

1. **蓝牙组件**: 使用 CatTag 库的 BluetoothComponent 进行设备通信
2. **消息处理**: 实现消息的发送、接收和显示
3. **连接管理**: 管理多个设备连接
4. **用户界面**: 基于命令行的交互界面

### 工作流程

1. **服务端模式**: 启动蓝牙服务，等待客户端连接
2. **客户端模式**: 扫描并连接到可用的服务端
3. **消息传输**: 通过蓝牙连接实时传输聊天消息
4. **状态监控**: 实时监控连接状态和设备健康

## 注意事项

- 此示例使用模拟蓝牙适配器，在实际环境中需要替换为真实的蓝牙适配器
- 确保设备支持蓝牙功能并已启用
- 某些操作系统可能需要管理员权限才能访问蓝牙功能
- 服务端和客户端需要使用相同的服务 UUID 才能正常连接

## 扩展功能

您可以基于此示例扩展以下功能：

- 文件传输支持
- 语音消息
- 群组聊天
- 消息加密
- 用户认证
- 聊天记录持久化
- 表情符号支持
- 消息状态（已读/未读）

## 故障排除

### 常见问题

1. **连接失败**: 检查蓝牙是否启用，设备是否在范围内
2. **权限错误**: 确保应用有蓝牙访问权限
3. **UUID 不匹配**: 确保服务端和客户端使用相同的服务 UUID
4. **消息丢失**: 检查网络连接质量和设备距离

### 调试模式

使用调试模式获取更详细的日志信息：

```bash
./chat -mode=server -log-level=debug
```

这将显示详细的蓝牙通信日志，有助于诊断问题。
